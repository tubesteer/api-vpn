<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title data-i18n="page_title">X - Proxy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">


<style>
  :root {
    --primary-bg: #2a2a2a;
    --card-bg: #3c3c3c;
    --accent-color: #8cff00; /* Default: Hijau Neon, akan diganti di bawah */
    --text-color: #e0e0e0;
    --secondary-text-color: #b0b0b0;
    --border-color: rgba(255, 255, 255, 0.15);
    --input-bg: #4a4a4a;
    --button-hover: #a3ff2e;
    --loader-color: #8cff00;
    --error-color: #ff6b6b;
    --success-color: #4caf50;
    --warning-color: #ff9800;
    /* --- PALET WARNA BARU (PASTEL MODERN) UNTUK DARK MODE --- */
    --accent-pastel: #A2E2F2; /* Biru Pastel */
    --accent-shadow: rgba(162, 226, 242, 0.5); /* Shadow untuk Biru Pastel */
    --button-hover-pastel: #C0F0FF;
    --success-pastel: #7ED957; /* Hijau Pastel */
    --error-pastel: #FF6961; /* Merah Pastel */
    --warning-pastel: #FFD166; /* Kuning Pastel */
  }

  body.light-mode {
    --primary-bg: #f0f0f0;
    --card-bg: #ffffff;
    --accent-color: #007bff;
    --text-color: #333333;
    --secondary-text-color: #666666;
    --border-color: rgba(0, 0, 0, 0.1);
    --input-bg: #e9ecef;
    --button-hover: #0056b3;
    --loader-color: #007bff;
    --error-color: #d9534f;
    --success-color: #5cb85c;
    --warning-color: #f0ad4e;
  }

  /* Menggunakan variabel warna pastel yang baru di dark mode */
  body:not(.light-mode) {
      --accent-color: var(--accent-pastel);
      --button-hover: var(--button-hover-pastel);
      --loader-color: var(--accent-pastel);
      --success-color: var(--success-pastel);
      --error-color: var(--error-pastel);
      --warning-color: var(--warning-pastel);
  }

  * {
    box-sizing: border-box;
    font-family: 'Inter', sans-serif;
  }

  body {
    margin: 0;
    padding: 1.5rem;
    background-color: var(--primary-bg);
    color: var(--text-color);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    line-height: 1.6;
    transition: background-color 0.3s, color 0.3s;
  }

  .app-container {
    background-color: var(--card-bg);
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
    width: 100%;
    max-width: 480px;
    padding: 1.5rem;
    border: 1px solid var(--border-color);
    position: relative;
    overflow: hidden;
  }

  .app-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .app-title {
    font-size: 2.2rem;
    font-weight: 700;
    color: var(--accent-color);
    text-shadow: 0 0 8px var(--accent-shadow); /* Menggunakan shadow pastel */
    margin-bottom: 0.5rem;
  }

  body.light-mode .app-title {
    text-shadow: none;
  }

  .app-subtitle {
    font-size: 0.95rem;
    color: var(--secondary-text-color);
  }

  .form-group {
    margin-bottom: 1rem;
  }

  .form-label {
    display: block;
    font-size: 0.9rem;
    color: var(--secondary-text-color);
    margin-bottom: 0.4rem;
  }

  .form-input,
  .form-select {
    width: 100%;
    padding: 0.8rem 1rem;
    background-color: var(--input-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-color);
    font-size: 0.95rem;
    transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.3s, color 0.3s;
  }

  .form-input::placeholder {
    color: var(--secondary-text-color);
    opacity: 0.7;
  }

  .form-input:focus,
  .form-select:focus {
    border-color: var(--accent-color);
    box-shadow: 0 0 0 3px var(--accent-shadow);
    outline: none;
  }

  body.light-mode .form-input:focus,
  body.light-mode .form-select:focus {
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.3);
  }

  .form-select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23b0b0b0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1rem;
  }

  .checkbox-container {
    display: flex;
    align-items: center;
    font-size: 0.9rem;
    color: var(--secondary-text-color);
    margin-top: 0.5rem;
  }

  .checkbox-container input[type="checkbox"] {
    margin-right: 0.6rem;
    width: 18px;
    height: 18px;
    appearance: none;
    border: 2px solid var(--border-color);
    border-radius: 4px;
    background-color: var(--input-bg);
    cursor: pointer;
    position: relative;
    transition: background-color 0.2s ease, border-color 0.2s ease;
  }

  .checkbox-container input[type="checkbox"]:checked {
    background-color: var(--accent-color);
    border-color: var(--accent-color);
  }

  .checkbox-container input[type="checkbox"]:checked::after {
    content: "\2713";
    font-size: 14px;
    color: var(--primary-bg);
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  .wildcard-toggle-area, .custom-country-input-area {
    height: 0;
    overflow: hidden;
    transition: height 0.3s ease-out, opacity 0.3s ease-out;
    opacity: 0;
  }

  .wildcard-toggle-area.show, .custom-country-input-area.show {
    height: auto;
    opacity: 1;
    padding-top: 0.5rem;
  }

  .btn-submit {
    width: 100%;
    padding: 1rem;
    background-color: var(--accent-color);
    color: var(--primary-bg);
    border: none;
    border-radius: 8px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
    box-shadow: 0 4px 15px var(--accent-shadow);
    margin-top: 1.5rem;
  }
  
  body.light-mode .btn-submit {
    color: white;
    box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4);
  }

  .btn-submit:hover {
    background-color: var(--button-hover);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px var(--accent-shadow);
  }
  
  body.light-mode .btn-submit:hover {
    box-shadow: 0 6px 20px rgba(0, 123, 255, 0.6);
  }

  .btn-submit:disabled {
    background-color: var(--accent-shadow);
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
  }
  
  body.light-mode .btn-submit:disabled {
    background-color: rgba(0, 123, 255, 0.4);
  }

  .copy-btn {
    background: none;
    border: none;
    color: var(--secondary-text-color);
    font-size: 0.9rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    transition: color 0.2s ease;
  }

  .copy-btn:hover {
    color: var(--accent-color);
  }
  
  /* --- PERBAIKAN ICON REFRESH --- */
  .refresh-status-btn {
      background-color: transparent;
      border: none;
      color: var(--text-color);
      width: 36px;
      height: 36px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: color 0.2s ease, transform 0.2s ease;
      font-size: 1rem;
  }
  .refresh-status-btn:hover {
      color: var(--accent-color);
      background-color: transparent;
      transform: scale(1.1);
  }
  .refresh-status-btn svg {
    width: 18px;
    height: 18px;
  }
  
  body.light-mode .refresh-status-btn:hover {
      background-color: transparent;
  }

  .result-area {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border-color);
  }

  .result-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .result-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--accent-color);
  }

  .code-snippet {
    width: 100%;
    min-height: 150px;
    max-height: 300px;
    padding: 1rem;
    background-color: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    color: #c9d1d9;
    font-family: 'Fira Code', 'Courier New', monospace;
    font-size: 0.85rem;
    resize: vertical;
    overflow: auto;
  }
  
  body.light-mode .code-snippet {
    background-color: #f8f9fa;
    color: #333;
  }

  /* Modal Overlay */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }
  
  body.light-mode .modal-overlay {
    background-color: rgba(0, 0, 0, 0.5);
  }

  .modal-overlay.visible {
    opacity: 1;
    visibility: visible;
  }

  /* General Modal Content */
  .modal-content {
    background-color: var(--card-bg);
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
    text-align: center;
    max-width: 350px;
    width: 90%;
    border: 1px solid var(--border-color);
    transform: translateY(-20px);
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }

  .modal-overlay.visible .modal-content {
    transform: translateY(0);
    opacity: 1;
  }
  
  /* Specific Loading Modal Content */
  .loading-modal-content {
      background-color: var(--card-bg);
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
      text-align: center;
      max-width: 300px; 
      width: 90%;
      border: 1px solid var(--border-color);
      transform: translateY(-20px);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
  }
  
  .modal-overlay.visible .loading-modal-content {
      transform: translateY(0);
      opacity: 1;
  }

  .loader-spin {
    border: 4px solid rgba(255, 255, 255, 0.2);
    border-top: 4px solid var(--loader-color);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin-bottom: 1rem;
  }
  
  body.light-mode .loader-spin {
    border: 4px solid rgba(0, 0, 0, 0.1);
    border-top: 4px solid var(--loader-color);
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .loading-text {
    color: var(--secondary-text-color);
    font-size: 1rem;
    text-align: center;
    margin-bottom: 0.5rem;
  }

  .loading-progress {
      color: var(--accent-color);
      font-weight: 600;
      margin-top: 0.5rem;
      font-size: 1.2rem;
      opacity: 0;
      transform: translateY(10px);
      animation: fadeInSlideUp 0.5s ease forwards;
      margin-bottom: 1rem;
  }

  @keyframes fadeInSlideUp {
      from {
          opacity: 0;
          transform: translateY(10px);
      }
      to {
          opacity: 1;
          transform: translateY(0);
      }
  }
  
  .cancel-btn {
      width: 100%;
      padding: 0.7rem;
      background-color: var(--error-color);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s ease;
  }
  
  .cancel-btn:hover {
      background-color: #ff4d4d;
  }
  
  .modal-message {
    font-size: 1.05rem;
    color: var(--text-color);
    margin-bottom: 1.5rem;
  }

  .modal-btn {
    padding: 0.7rem 1.5rem;
    background-color: var(--accent-color);
    color: var(--primary-bg);
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  .modal-btn:hover {
    background-color: var(--button-hover);
  }
  
  body.light-mode .modal-btn {
    color: white;
  }

  @media (max-width: 400px) {
    body {
      padding: 1rem;
    }
    .app-title {
      font-size: 1.8rem;
    }
    .form-input, .form-select, .btn-submit {
      font-size: 0.9rem;
      padding: 0.7rem 0.9rem;
    }
    .btn-submit {
        padding: 0.8rem;
    }
  }

  .main-tabs {
      display: flex;
      justify-content: space-around;
      margin-bottom: 1.5rem;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 0.5rem;
      gap: 0.5rem;
  }

  .main-tab-button {
      flex-grow: 1;
      padding: 0.8rem 1rem;
      background: none;
      border: none;
      color: var(--secondary-text-color);
      font-weight: 600;
      cursor: pointer;
      transition: color 0.2s ease;
      position: relative;
      text-align: center;
      font-size: 1rem;
  }

  .main-tab-button:hover {
      color: var(--accent-color);
  }

  .main-tab-button.active {
      color: var(--accent-color);
  }

  .main-tab-button.active::after {
      content: '';
      position: absolute;
      bottom: -0.5rem;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      height: 2px;
      background-color: var(--accent-color);
      border-radius: 1px;
  }

  .tab-content.hidden {
      display: none;
  }
  .status-list-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.75rem;
  }

  .proxy-item-card-status {
    background-color: rgba(0, 0, 0, 0.2);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }
  
  body.light-mode .proxy-item-card-status {
    background-color: #f8f9fa;
  }

  .proxy-item-card-status > div {
      width: 100%;
  }

  .proxy-card-header-status {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
      flex-wrap: wrap;
      gap: 0.5rem;
  }

  .proxy-name-status {
      font-weight: 600;
      color: var(--text-color);
      font-size: 1rem;
      word-break: break-word;
      flex-grow: 1;
  }

  .status-info-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-left: 0.5rem;
      flex-shrink: 0;
  }
  .status-info-dot.active { background-color: var(--success-color); }
  .status-info-dot.dead { background-color: var(--error-color); }
  .status-info-dot.unknown { background-color: var(--warning-color); }

  .proxy-details-status {
      font-size: 0.85rem;
      color: var(--secondary-text-color);
  }

  .proxy-latency-status {
      font-size: 0.85rem;
      color: var(--secondary-text-color);
      display: flex;
      align-items: center;
      gap: 0.25rem;
      margin-top: 0.25rem;
  }
  .latency-text-active { color: var(--success-color); }
  .latency-text-dead { color: var(--error-color); }
  .latency-text-unknown { color: var(--warning-color); }

  .status-pagination-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 1.5rem;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .pagination-btn {
    min-width: 36px;
    height: 36px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: all 0.2s ease;
    background-color: rgba(0, 0, 0, 0.15);
    border: 1px solid var(--border-color);
    color: var(--text-color);
    cursor: pointer;
  }
  
  body.light-mode .pagination-btn {
    background-color: rgba(0, 0, 0, 0.05);
  }
  
  .pagination-btn.active {
    background-color: var(--accent-color);
    color: var(--primary-bg);
    border-color: var(--accent-color);
    font-weight: 600;
  }
  
  body.light-mode .pagination-btn.active {
    color: white;
  }

  .pagination-btn:not(.active):not(.disabled):hover {
      background-color: rgba(0, 0, 0, 0.25);
      border-color: var(--accent-color);
  }
  
  body.light-mode .pagination-btn:not(.active):not(.disabled):hover {
    background-color: rgba(0, 0, 0, 0.1);
  }
  
  .pagination-btn.disabled {
      opacity: 0.5;
      cursor: not-allowed;
  }
  .pagination-ellipsis {
      color: var(--secondary-text-color);
      padding: 0 0.25rem;
  }

  .status-count-info {
      text-align: center;
      font-size: 0.9rem;
      color: var(--secondary-text-color);
      margin-top: 0.75rem;
  }

  /* New styles for mode and language toggles */
  .settings-container {
      position: absolute;
      top: 1rem;
      right: 1.5rem;
      z-index: 10;
      display: flex;
      gap: 10px;
      align-items: center;
  }
  
.icon-button {
    background-color: transparent;
    border: none;
    color: var(--text-color);
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: color 0.2s ease, transform 0.2s ease;
    font-size: 1rem;
}

.icon-button:hover {
    color: var(--accent-color);
    background-color: transparent;
    transform: scale(1.1);
}

body.light-mode .icon-button:hover {
    background-color: transparent;
}

  .dropdown {
      position: relative;
      display: inline-block;
  }

  .dropdown-content {
      display: none;
      position: absolute;
      background-color: var(--input-bg);
      min-width: 150px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.5);
      z-index: 1;
      border-radius: 8px;
      padding: 5px;
      top: 45px;
      right: 0;
      border: 1px solid var(--border-color);
      animation: fadeIn 0.2s ease-out;
  }
  
  @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
  }
  
  .dropdown-content.show {
      display: block;
  }

  .dropdown-item {
      color: var(--text-color);
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      cursor: pointer;
      border-radius: 6px;
      transition: background-color 0.2s, color 0.2s;
  }
  
  .dropdown-item:hover {
      background-color: var(--card-bg);
  }

</style>
  </head>
  <body>
    <div class="settings-container">
        <button id="theme-toggle" class="icon-button" title="Toggle Theme">
            <i class="fas fa-sun"></i>
        </button>
        <div class="dropdown">
            <button id="language-toggle" class="icon-button" title="Select Language">
                <i class="fas fa-globe"></i>
            </button>
            <div id="language-dropdown" class="dropdown-content">
                <a href="#" class="dropdown-item" data-lang="id">Bahasa Indonesia</a>
                <a href="#" class="dropdown-item" data-lang="en">English</a>
            </div>
        </div>
    </div>
    <div class="app-container">
      <header class="app-header">
        <h1 class="app-title" data-i18n="app_title">X-Proxy</h1>
     </header>

      <div class="main-tabs">
          <button class="main-tab-button active" data-tab="generator" data-i18n="generator_tab">Generator</button>
          <button class="main-tab-button" data-tab="status" data-i18n="status_tab">Daftar Proxy</button>
      </div>

      <main class="main-content">
        <section id="generator-section" class="tab-content">
          <form id="proxy-generator-form">
            <div class="form-group">
              <label for="vpn-type" class="form-label" data-i18n="vpn_type_label">VPN Type</label>
              <select id="vpn-type" name="vpnType" class="form-select">
                <option value="vmess">VMess</option>
                <option value="vless">VLESS</option>
                <option value="trojan">Trojan</option>
                <option value="ss">Shadowsocks (SS)</option>
              </select>
            </div>

            <div class="form-group">
              <label for="country" class="form-label" data-i18n="country_label">Negara</label>
              <select id="country" name="country" class="form-select">
                <option value="ID" data-i18n="country_id">Indonesia (ID)</option>
                <option value="SG" data-i18n="country_sg">Singapura (SG)</option>
                <option value="CUSTOM" data-i18n="country_custom">Kustom (Masukkan ID Negara)</option>
              </select>
            </div>
            
            <div id="custom-country-input-area" class="custom-country-input-area">
                <div class="form-group">
                    <label for="custom-country-id" class="form-label" data-i18n="custom_country_label">ID Negara Kustom</label>
                    <input type="text" id="custom-country-id" name="customCountryId" class="form-input" data-i18n-placeholder="custom_country_placeholder" placeholder="misal: US, JP, FR" maxlength="2" />
                    <div id="custom-country-count-info" style="font-size: 0.85rem; color: var(--secondary-text-color); margin-top: 5px;"></div>
                </div>
            </div>

            <div class="form-group">
              <label for="tls" class="form-label" data-i18n="tls_label">TLS</label>
              <select id="tls" name="security" class="form-select">
                <option value="tls" data-i18n="tls_option_tls">TLS</option>
                <option value="none" data-i18n="tls_option_nontls">NonTLS</option>
              </select>
            </div>

            <div class="form-group">
              <label for="server-domain" class="form-label" data-i18n="server_domain_label">Domain Server</label>
              <select id="server-domain" name="serverDomain" class="form-select"></select>
            </div>

            <div class="form-group">
              <label for="bug-custom" class="form-label" data-i18n="custom_bug_label">Bug Kustom (opsional)</label>
              <input type="text" id="bug-custom" name="bug" class="form-input" data-i18n-placeholder="custom_bug_placeholder" placeholder="misal: bug.com" />
              <div id="wildcard-container" class="wildcard-toggle-area">
                <div class="checkbox-container">
                  <input type="checkbox" id="wildcard" name="wildcard" />
                  <label for="wildcard" data-i18n="wildcard_label">Gunakan Wildcard (bug.domain.com)</label>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="limit" class="form-label" data-i18n="limit_label">Batas Akun (jumlah)</label>
              <input type="number" id="limit" name="limit" class="form-input" value="1" min="1" max="100" />
            </div>

            <div class="checkbox-container" style="margin-top: 1rem;">
                <input type="checkbox" id="get-active-only" name="getActiveOnly" checked />
                <label for="get-active-only" data-i18n="get_active_only_label">Ambil proxy yang aktif</label>
            </div>
            
            <button type="submit" class="btn-submit" data-i18n="get_account_btn">Ambil Akun</button>
          </form>
        </section>

        <section id="status-section" class="tab-content hidden">
            <div class="form-group">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 class="result-title" style="margin-bottom: 0;" data-i18n="all_proxies_list_title">Daftar Semua Proxy</h3>
                    <button id="refresh-status-btn" class="refresh-status-btn" title="Refresh">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="23 4 23 10 17 10"></polyline>
        <polyline points="1 20 1 14 7 14"></polyline>
        <path d="M3.5 9a9 9 0 0 1 17 0"></path>
        <path d="M20.5 15a9 9 0 0 1-17 0"></path>
    </svg>
</button>
                </div>
                <input type="text" id="status-search-input" class="form-input" data-i18n-placeholder="status_search_placeholder" placeholder="Cari IP, Negara, atau Penyedia..." />
            </div>

            <div id="status-proxy-list-container" class="status-list-grid">
            </div>

            <div id="status-pagination-container" class="status-pagination-container"></div>
            <div id="status-count-info" class="status-count-info"></div>

            <div id="no-status-proxies-message" class="loading-indicator hidden" style="padding-top: 2rem;">
                <p class="loading-text"></p>
            </div>
        </section>
      </main>

      <div id="loading-overlay" class="modal-overlay hidden">
          <div class="loading-modal-content">
              <div class="loader-spin"></div>
              <p class="loading-text" data-i18n="loading_text">Memproses...</p>
              <span id="loading-progress" class="loading-progress"></span>
              <button id="cancel-loading-btn" class="cancel-btn" data-i18n="cancel_btn">Batalkan</button>
          </div>
      </div>

      <div id="config-url-modal" class="modal-overlay hidden">
          <div class="modal-content" style="max-width: 600px; text-align: left;">
            <div class="result-header">
              <h3 class="result-title" data-i18n="config_url_title">URL Konfigurasi</h3>
              <button id="copy-all-urls-modal" class="copy-btn" data-i18n="copy_all_btn">Salin Semua</button>
            </div>
            <textarea id="generated-urls-output" class="code-snippet" readonly></textarea>
            <button id="close-config-modal" class="modal-btn" style="margin-top: 1.5rem; width: 100%;" data-i18n="close_modal_btn">Tutup</button>
          </div>
      </div>
      
      <div id="custom-message-modal" class="modal-overlay hidden">
          <div class="modal-content">
            <p id="modal-text" class="modal-message"></p>
            <button class="modal-btn" onclick="hideMessage()" data-i18n="ok_btn">Oke</button>
          </div>
      </div>

    <script>
      const baseUrl = "https://raw.githubusercontent.com/tubesteer/proxy_ip/refs/heads/main/";
      const serverDomains = ["tubesteer.dpdns.org"];
      const defaultUUID = "aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee";

      let allProxies = [];
      let filteredStatusProxies = [];
      const statusItemsPerPage = 10;
      let currentStatusPage = 1;
      let abortController = null;
      let currentLanguage = localStorage.getItem('language') || 'id';
      let currentTheme = localStorage.getItem('theme') || 'dark';

      const translations = {
          id: {
              page_title: 'X - Proxy',
              app_title: 'X-Proxy',
              generator_tab: 'Generator',
              status_tab: 'Daftar Proxy',
              vpn_type_label: 'Tipe VPN',
              country_label: 'Negara',
              country_id: 'Indonesia (ID)',
              country_sg: 'Singapura (SG)',
              country_custom: 'Kustom (Masukkan ID Negara)',
              custom_country_label: 'ID Negara Kustom',
              custom_country_placeholder: 'misal: US, JP, FR',
              tls_label: 'TLS',
              tls_option_tls: 'TLS',
              tls_option_nontls: 'NonTLS',
              server_domain_label: 'Domain Server',
              custom_bug_label: 'Bug Kustom (opsional)',
              custom_bug_placeholder: 'misal: bug.com',
              wildcard_label: 'Gunakan Wildcard (bug.domain.com)',
              limit_label: 'Batas Akun (jumlah)',
              get_active_only_label: 'Ambil proxy yang aktif',
              get_account_btn: 'Ambil Akun',
              config_url_title: 'URL Konfigurasi',
              copy_all_btn: 'Salin Semua',
              all_proxies_list_title: 'Daftar Semua Proxy',
              status_search_placeholder: 'Cari IP, Negara, atau Penyedia...',
              status_count_info: (start, end, total) => `Menampilkan ${start}-${end} dari ${total} proxy`,
              loading_calculating: 'Menghitung jumlah proxy...',
              loading_fetching: 'Memuat daftar proxy...',
              loading_searching: 'Pengujian akun yang aktif',
              loading_updating: 'Memperbarui Daftar proxy...',
              loading_checking: 'Memeriksa...',
              cancel_btn: 'Batalkan',
              message_positive_limit: 'Batas akun harus berupa angka positif.',
              message_custom_country_invalid: 'ID Negara kustom harus terdiri dari 2 huruf (misal: US).',
              message_error_fetch: 'Terjadi kesalahan saat memuat daftar proxy awal: ',
              message_no_proxies_available: '',
              message_no_active_found: 'Tidak ada akun aktif yang ditemukan dengan kriteria ini. Silakan coba lagi nanti atau sesuaikan filter.',
              message_aborted: 'Proses pencarian dibatalkan.',
              message_copy_success: 'Berhasil Disalin!',
              message_copy_failed: 'Gagal menyalin URL. Harap salin secara manual.',
              ok_btn: 'Oke',
              close_modal_btn: 'Tutup',
              status_active: 'Aktif',
              status_dead: 'Mati',
              status_unknown: 'Memeriksa...',
              latency_checking: 'Memeriksa...',
              latency_dead: 'Mati',
          },
          en: {
              page_title: 'X - Proxy',
              app_title: 'X-Proxy',
              generator_tab: 'Generator',
              status_tab: 'Proxy List',
              vpn_type_label: 'VPN Type',
              country_label: 'Country',
              country_id: 'Indonesia (ID)',
              country_sg: 'Singapore (SG)',
              country_custom: 'Custom (Enter Country ID)',
              custom_country_label: 'Custom Country ID',
              custom_country_placeholder: 'e.g.: US, JP, FR',
              tls_label: 'TLS',
              tls_option_tls: 'TLS',
              tls_option_nontls: 'NonTLS',
              server_domain_label: 'Server Domain',
              custom_bug_label: 'Custom Bug (optional)',
              custom_bug_placeholder: 'e.g.: bug.com',
              wildcard_label: 'Use Wildcard (bug.domain.com)',
              limit_label: 'Account Limit (count)',
              get_active_only_label: 'Fetch active proxies',
              get_account_btn: 'Get Account',
              config_url_title: 'Configuration URL',
              copy_all_btn: 'Copy All',
              all_proxies_list_title: 'List of All Proxies',
              status_search_placeholder: 'Search IP, Country, or Provider...',
              status_count_info: (start, end, total) => `Showing ${start}-${end} of ${total} proxies`,
              loading_calculating: 'Calculating proxy count...',
              loading_fetching: 'Loading proxy list...',
              loading_searching: 'Testing for accounts',
              loading_updating: 'Updating proxy list...',
              loading_checking: 'Checking...',
              cancel_btn: 'Cancel',
              message_positive_limit: 'Account limit must be a positive number.',
              message_custom_country_invalid: 'Custom Country ID must be 2 letters (e.g.: US).',
              message_error_fetch: 'An error occurred while loading the initial proxy list: ',
              message_no_proxies_available: '',
              message_no_active_found: 'No active accounts found with this criteria. Please try again later or adjust filters.',
              message_aborted: 'Search process was cancelled.',
              message_copy_success: 'Copied Successfully!',
              message_copy_failed: 'Failed to copy URL. Please copy manually.',
              ok_btn: 'Ok',
              close_modal_btn: 'Close',
              status_active: 'Active',
              status_dead: 'Dead',
              status_unknown: 'Checking...',
              latency_checking: 'Checking...',
              latency_dead: 'Dead',
          }
      };

      const languageToggleBtn = document.getElementById("language-toggle");
      const languageDropdown = document.getElementById("language-dropdown");
      const themeToggleBtn = document.getElementById("theme-toggle");

      const configUrlModal = document.getElementById("config-url-modal");
      const closeConfigModalBtn = document.getElementById("close-config-modal");

      const mainTabsContainer = document.querySelector(".main-tabs");
      const generatorSection = document.getElementById("generator-section");
      const statusSection = document.getElementById("status-section");

      const proxyGeneratorForm = document.getElementById("proxy-generator-form");
      const vpnTypeSelect = document.getElementById("vpn-type");
      const countrySelect = document.getElementById("country");
      const customCountryInputArea = document.getElementById("custom-country-input-area");
      const customCountryInput = document.getElementById("custom-country-id");
      const customCountryCountInfo = document.getElementById("custom-country-count-info");
      const bugCustomInput = document.getElementById("bug-custom");
      const wildcardContainer = document.getElementById("wildcard-container");
      const wildcardCheckbox = document.getElementById("wildcard");
      const serverDomainSelect = document.getElementById("server-domain");
      const getActiveOnlyCheckbox = document.getElementById("get-active-only");

      const statusSearchInput = document.getElementById("status-search-input");
      const statusProxyListContainer = document.getElementById("status-proxy-list-container");
      const statusPaginationContainer = document.getElementById("status-pagination-container");
      const statusCountInfo = document.getElementById("status-count-info");
      const noStatusProxiesMessage = document.getElementById("no-status-proxies-message");
      const refreshStatusBtn = document.getElementById("refresh-status-btn");

      const loadingOverlay = document.getElementById("loading-overlay");
      const loadingText = loadingOverlay.querySelector('.loading-text');
      const loadingProgress = document.getElementById("loading-progress");
      const cancelLoadingBtn = document.getElementById("cancel-loading-btn");
      const generatedUrlsOutput = document.getElementById("generated-urls-output");
      const copyAllUrlsBtn = document.getElementById("copy-all-urls-modal");
      const messageModal = document.getElementById("custom-message-modal");
      const modalText = document.getElementById("modal-text");

      function updateUIforLanguage(lang) {
          currentLanguage = lang;
          localStorage.setItem('language', lang);
          document.querySelectorAll('[data-i18n]').forEach(element => {
              const key = element.getAttribute('data-i18n');
              if (translations[lang][key]) {
                  element.textContent = translations[lang][key];
              }
          });
          document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
              const key = element.getAttribute('data-i18n-placeholder');
              if (translations[lang][key]) {
                  element.placeholder = translations[lang][key];
              }
          });
          // Special handling for dynamic content
          updateCountryOptions(false);
          renderStatusProxyList();
      }

      function toggleTheme() {
          if (document.body.classList.contains('light-mode')) {
              document.body.classList.remove('light-mode');
              currentTheme = 'dark';
              themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
              localStorage.setItem('theme', 'dark');
          } else {
              document.body.classList.add('light-mode');
              currentTheme = 'light';
              themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
              localStorage.setItem('theme', 'light');
          }
      }
      
      function showLoading(messageKey, showProgress = false, showCancel = false) {
          loadingText.textContent = translations[currentLanguage][messageKey];
          loadingOverlay.classList.remove("hidden");
          loadingOverlay.classList.add("visible");
          loadingProgress.style.display = showProgress ? 'block' : 'none';
          cancelLoadingBtn.style.display = showCancel ? 'block' : 'none';
      }

      function hideLoading() {
          loadingOverlay.classList.remove("visible");
          if (abortController) {
            abortController.abort();
            abortController = null;
          }
          setTimeout(() => {
              loadingOverlay.classList.add("hidden");
          }, 300);
      }

      function updateLoadingProgress(activeCount, totalNeeded) {
          loadingProgress.textContent = `${activeCount} / ${totalNeeded}`;
          loadingProgress.style.opacity = 1;
          loadingProgress.style.transform = 'translateY(0)';
      }

      function displayMessage(messageKey, ...args) {
        let message = translations[currentLanguage][messageKey] || messageKey;
        if (typeof message === 'function') {
            message = message(...args);
        } else if (args.length > 0) {
            message = message.replace(/{(\d+)}/g, (match, number) => {
                return typeof args[number] != 'undefined' ? args[number] : match;
            });
        }
        modalText.textContent = message;
        messageModal.classList.remove("hidden");
        messageModal.classList.add("visible");
      }

      function hideMessage() {
        messageModal.classList.remove("visible");
        setTimeout(() => {
            messageModal.classList.add("hidden");
        }, 300);
      }

      function showConfigUrlModal() {
          configUrlModal.classList.remove("hidden");
          configUrlModal.classList.add("visible");
      }
      
      function hideConfigUrlModal() {
          configUrlModal.classList.remove("visible");
          setTimeout(() => {
              configUrlModal.classList.add("hidden");
          }, 300);
      }

      function shuffleArray(array) {
          for (let i = array.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [array[i], array[j]] = [array[j], array[i]];
          }
          return array;
      }

      async function getProxyListFromUrl(url, signal = null) {
        try {
          const response = await fetch(url, { signal });
          if (!response.ok) {
            throw new Error(`Failed to load proxy list from URL: ${response.statusText}`);
          }
          const text = await response.text();
          const lines = text.split(/\r?\n/).filter((line) => line.trim() !== "");

          let delimiter = ",";
          if (lines.length > 0) {
              const firstLine = lines[0];
              if (firstLine.includes("\t")) {
                delimiter = "\t";
              } else if (firstLine.includes("|")) {
                delimiter = "|";
              } else if (firstLine.includes(";")) {
                delimiter = ";";
              }
          }

          const parsedList = lines
            .map((line) => {
              const parts = line.split(delimiter);
              if (parts.length >= 2) {
                return {
                  ip: parts[0].trim(),
                  port: parts[1].trim(),
                  country: parts.length >= 3 ? parts[2].trim() : "Unknown",
                  provider: parts.length >= 4 ? parts[3].trim() : "Unknown Provider",
                };
              }
              return null;
            })
            .filter((proxy) => proxy && proxy.ip && proxy.port);
          
          console.log(`Proxy list loaded from URL: ${parsedList.length} items.`);
          return parsedList;

        } catch (error) {
          if (error.name === 'AbortError') {
              console.log('Fetch aborted');
              return [];
          }
          console.error("Fetch/Parse Error:", error);
          return [];
        }
      }

      async function checkProxyStatus(proxy, signal = null) {
        const statusURL = `https://yumiwolker.mayumiyui.workers.dev/check?target=${proxy.ip}:${proxy.port}`;
        const startTime = performance.now();
        try {
          const response = await fetch(statusURL, { signal, timeout: 5000 });
          const data = await response.json();
          const endTime = performance.now();
          const latency = Math.floor(endTime - startTime);
          return {
              isActive: data.proxyip === true,
              latency: latency
          };
        } catch (error) {
          if (error.name === 'AbortError' || error.name === 'TimeoutError') {
              console.log('Check aborted/timed out for:', proxy.ip);
              return { isActive: false, latency: 'Timeout' };
          }
          console.error(`Error checking proxy ${proxy.ip}:${proxy.port}:`, error);
          return {
              isActive: false,
              latency: 'N/A'
          };
        }
      }

      async function updateCountryOptions(showLoadingIndicator = true) {
          if (showLoadingIndicator) showLoading("loading_calculating", false, false);
          const countriesToUpdate = [
              { code: "ID", key: "country_id" },
              { code: "SG", key: "country_sg" }
          ];

          const fetchPromises = countriesToUpdate.map(country => 
            getProxyListFromUrl(`${baseUrl}${country.code}.txt`)
          );

          try {
            const results = await Promise.all(fetchPromises);
            countriesToUpdate.forEach((country, index) => {
                const proxies = results[index];
                const option = countrySelect.querySelector(`option[value="${country.code}"]`);
                if (option) {
                    const countryTranslation = translations[currentLanguage][country.key];
                    // Ensure the part before the parenthesis is used for the count.
                    const countryName = countryTranslation.split(' ')[0];
                    option.textContent = `${countryName} (${proxies.length} proxy)`;
                }
            });
          } catch (error) {
              console.error("Failed to fetch all country lists:", error);
          } finally {
              if (showLoadingIndicator) hideLoading();
          }
      }

      function renderStatusPagination(totalPages) {
          statusPaginationContainer.innerHTML = "";
          if (totalPages <= 1) return;

          const createPaginationButton = (text, page, isActive = false, isDisabled = false) => {
              const btn = document.createElement("button");
              btn.className = `pagination-btn ${isActive ? 'active' : ''} ${isDisabled ? 'disabled' : ''}`;
              btn.innerHTML = text;
              btn.disabled = isDisabled;
              btn.addEventListener("click", () => {
                  if (!isDisabled) {
                      currentStatusPage = page;
                      renderStatusProxyList();
                  }
              });
              return btn;
          };

          statusPaginationContainer.appendChild(createPaginationButton(
              '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.41 16.59L10.83 12L15.41 7.41L14 6L8 12L14 18L15.41 16.59Z" fill="currentColor"/></svg>',
              currentStatusPage - 1, false, currentStatusPage === 1
          ));

          const maxVisiblePages = window.innerWidth < 640 ? 3 : 5;
          let startPage = Math.max(1, currentStatusPage - Math.floor(maxVisiblePages / 2));
          let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

          if (endPage - startPage + 1 < maxVisiblePages) {
              startPage = Math.max(1, endPage - maxVisiblePages + 1);
          }

          if (startPage > 1) {
              statusPaginationContainer.appendChild(createPaginationButton('1', 1));
              if (startPage > 2) {
                  const ellipsis = document.createElement("span");
                  ellipsis.className = "pagination-ellipsis";
                  ellipsis.textContent = "...";
                  statusPaginationContainer.appendChild(ellipsis);
              }
          }

          for (let i = startPage; i <= endPage; i++) {
              statusPaginationContainer.appendChild(createPaginationButton(String(i), i, i === currentStatusPage));
          }

          if (endPage < totalPages) {
              if (endPage < totalPages - 1) {
                  const ellipsis = document.createElement("span");
                  ellipsis.className = "pagination-ellipsis";
                  ellipsis.textContent = "...";
                  statusPaginationContainer.appendChild(ellipsis);
              }
              statusPaginationContainer.appendChild(createPaginationButton(String(totalPages), totalPages));
          }

          statusPaginationContainer.appendChild(createPaginationButton(
              '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.59L13.17 12L8.59 7.41L10 6L16 12L10 18L8.59 16.59Z" fill="currentColor"/></svg>',
              currentStatusPage + 1, false, currentStatusPage === totalPages
          ));
      }

      async function renderStatusProxyList() {
          statusProxyListContainer.innerHTML = "";
          noStatusProxiesMessage.classList.add("hidden");
          
          const searchTerm = statusSearchInput.value.toLowerCase().trim();
          if (searchTerm) {
              filteredStatusProxies = allProxies.filter(proxy =>
                  proxy.ip.includes(searchTerm) ||
                  proxy.port.includes(searchTerm) ||
                  proxy.country.toLowerCase().includes(searchTerm) ||
                  proxy.provider.toLowerCase().includes(searchTerm)
              );
          } else {
              filteredStatusProxies = [...allProxies];
          }

          if (filteredStatusProxies.length === 0) {
              noStatusProxiesMessage.classList.remove("hidden");
              noStatusProxiesMessage.querySelector('p').textContent = translations[currentLanguage].message_no_proxies_available;
              statusPaginationContainer.innerHTML = "";
              statusCountInfo.textContent = "";
              return;
          }

          const totalPages = Math.ceil(filteredStatusProxies.length / statusItemsPerPage);
          currentStatusPage = Math.min(currentStatusPage, totalPages);
          const startIndex = (currentStatusPage - 1) * statusItemsPerPage;
          const endIndex = Math.min(startIndex + statusItemsPerPage, filteredStatusProxies.length);

          const currentItems = filteredStatusProxies.slice(startIndex, endIndex);

          statusCountInfo.textContent = translations[currentLanguage].status_count_info(startIndex + 1, endIndex, filteredStatusProxies.length);

          for (const proxy of currentItems) {
              const card = document.createElement("div");
              card.className = "proxy-item-card-status";
              card.innerHTML = `
                  <div class="proxy-card-header-status">
                      <div class="proxy-name-status">${proxy.provider} (${proxy.country})</div>
                      <span id="status-dot-${proxy.ip}-${proxy.port}" class="status-info-dot"></span>
                  </div>
                  <div class="proxy-details-status">${proxy.ip}:${proxy.port}</div>
                  <div id="proxy-latency-status-${proxy.ip}-${proxy.port}" class="proxy-latency-status">
                      <span data-i18n="latency_label">Latensi</span>: <span class="latency-text-unknown">${translations[currentLanguage].latency_checking}</span>
                  </div>
              `;
              statusProxyListContainer.appendChild(card);

              const statusDotEl = document.getElementById(`status-dot-${proxy.ip}-${proxy.port}`);
              const latencyTextEl = document.getElementById(`proxy-latency-status-${proxy.ip}-${proxy.port}`).querySelector('span:last-child');

              statusDotEl.className = "status-info-dot unknown";
              statusDotEl.title = translations[currentLanguage].status_unknown;
              latencyTextEl.textContent = translations[currentLanguage].latency_checking;
              latencyTextEl.className = "latency-text-unknown";

              checkProxyStatus(proxy).then(result => {
                  if (result.isActive) {
                      statusDotEl.className = "status-info-dot active";
                      statusDotEl.title = translations[currentLanguage].status_active;
                      latencyTextEl.textContent = `${result.latency}ms`;
                      latencyTextEl.className = "latency-text-active";
                  } else {
                      statusDotEl.className = "status-info-dot dead";
                      statusDotEl.title = translations[currentLanguage].status_dead;
                      latencyTextEl.textContent = result.latency === 'N/A' ? 'N/A' : translations[currentLanguage].latency_dead;
                      latencyTextEl.className = "latency-text-dead";
                  }
              });
          }
          renderStatusPagination(totalPages);
      }

      document.addEventListener("DOMContentLoaded", async function () {
        // Apply initial theme from localStorage
        if (currentTheme === 'light') {
            document.body.classList.add('light-mode');
            themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
        } else {
            document.body.classList.remove('light-mode');
            themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
        }

        updateUIforLanguage(currentLanguage);
        showLoading("loading_fetching", false, false);
        
        allProxies = await getProxyListFromUrl(`${baseUrl}ALL.txt`);
        
        await updateCountryOptions(false); // Update with country counts but no separate loading indicator
        
        hideLoading();

        serverDomains.forEach((domain) => {
          const option = document.createElement("option");
          option.value = domain;
          option.textContent = domain;
          serverDomainSelect.appendChild(option);
        });
        serverDomainSelect.value = serverDomains[0];

        // Language toggle event listeners
        languageToggleBtn.addEventListener('click', (event) => {
            languageDropdown.classList.toggle('show');
            event.stopPropagation(); // Prevent click from bubbling to document
        });

        languageDropdown.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', (event) => {
                event.preventDefault();
                updateUIforLanguage(item.dataset.lang);
                languageDropdown.classList.remove('show');
            });
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (event) => {
            if (!languageDropdown.contains(event.target) && !languageToggleBtn.contains(event.target)) {
                languageDropdown.classList.remove('show');
            }
        });
        
        // Theme toggle event listener
        themeToggleBtn.addEventListener('click', toggleTheme);
        
        mainTabsContainer.addEventListener("click", function (event) {
          if (event.target.classList.contains("main-tab-button")) {
            const clickedTab = event.target;
            const targetTabId = clickedTab.dataset.tab;

            document.querySelector(".main-tab-button.active").classList.remove("active");
            clickedTab.classList.add("active");

            document.querySelectorAll(".tab-content").forEach(content => content.classList.add("hidden"));

            document.getElementById(targetTabId + "-section").classList.remove("hidden");

            if (targetTabId === "status") {
                currentStatusPage = 1;
                renderStatusProxyList();
            }
          }
        });

        countrySelect.addEventListener("change", function() {
            if (this.value === "CUSTOM") {
                customCountryInputArea.classList.add("show");
            } else {
                customCountryInputArea.classList.remove("show");
                customCountryInput.value = "";
                customCountryCountInfo.textContent = "";
            }
        });

        customCountryInput.addEventListener("input", async function() {
            const customCountryId = this.value.toUpperCase().trim();
            if (customCountryId.length === 2) {
                customCountryCountInfo.textContent = translations[currentLanguage].loading_checking;
                const url = `${baseUrl}${customCountryId}.txt`;
                const proxies = await getProxyListFromUrl(url);
                if (proxies.length > 0) {
                    const countryTranslation = translations[currentLanguage].country_id; // Using ID as a base for text
                    const countryName = countryTranslation.split(' ')[0];
                    customCountryCountInfo.textContent = `${countryName}: ${proxies.length} proxy tersedia.`;
                    customCountryCountInfo.style.color = "var(--success-color)";
                } else {
                    customCountryCountInfo.textContent = translations[currentLanguage].message_no_proxies_available;
                    customCountryCountInfo.style.color = "var(--error-color)";
                }
            } else {
                customCountryCountInfo.textContent = "";
            }
        });

        bugCustomInput.addEventListener("input", function () {
          if (this.value.trim() !== "") {
            wildcardContainer.classList.add("show");
          } else {
            wildcardContainer.classList.remove("show");
            wildcardCheckbox.checked = false;
          }
        });
        
        cancelLoadingBtn.addEventListener('click', () => {
            if (abortController) {
                abortController.abort();
                displayMessage("message_aborted");
            }
            hideLoading();
        });

        closeConfigModalBtn.addEventListener('click', hideConfigUrlModal);

        proxyGeneratorForm.addEventListener("submit", async function (e) {
          e.preventDefault();
          
          const formData = new FormData(proxyGeneratorForm);
          const vpnType = formData.get("vpnType");
          const countryFilter = formData.get("country");
          const requestedLimit = parseInt(formData.get("limit"), 10);
          const security = formData.get("security");
          const customBug = formData.get("bug") ? formData.get("bug").toString().trim() : "";
          const useWildcard = formData.get("wildcard") === "on";
          const selectedDomain = formData.get("serverDomain") || serverDomains[0];
          const getActiveOnly = getActiveOnlyCheckbox.checked;

          if (isNaN(requestedLimit) || requestedLimit < 1) {
              displayMessage("message_positive_limit");
              return;
          }

          showLoading("loading_searching", getActiveOnly, getActiveOnly);
          if (getActiveOnly) {
            updateLoadingProgress(0, requestedLimit);
          }
          
          abortController = new AbortController();
          const signal = abortController.signal;

          let fetchUrl;
          if (countryFilter === "CUSTOM") {
              const customCountryId = customCountryInput.value.toUpperCase().trim();
              if (customCountryId.length !== 2) {
                  displayMessage("message_custom_country_invalid");
                  hideLoading();
                  return;
              }
              fetchUrl = `${baseUrl}${customCountryId}.txt`;
          } else {
              fetchUrl = `${baseUrl}${countryFilter}.txt`;
          }

          let eligibleProxies = [];
          try {
              eligibleProxies = await getProxyListFromUrl(fetchUrl, signal);
          } catch (error) {
              if (error.name !== 'AbortError') {
                  displayMessage("message_error_fetch" + error.message);
              }
              hideLoading();
              return;
          }

          if (eligibleProxies.length === 0) {
              displayMessage("message_no_proxies_available");
              hideLoading();
              return;
          }
          
          const shuffledProxies = shuffleArray([...eligibleProxies]);

          let proxiesToGenerate = [];

          if (getActiveOnly) {
              for (let i = 0; i < shuffledProxies.length; i++) {
                  if (signal.aborted) break;
                  
                  const proxy = shuffledProxies[i];
                  const result = await checkProxyStatus(proxy, signal);
                  
                  if (result.isActive) {
                      proxiesToGenerate.push({ ...proxy, isActive: true });
                      updateLoadingProgress(proxiesToGenerate.length, requestedLimit);
                  }

                  if (proxiesToGenerate.length >= requestedLimit) {
                      break;
                  }
              }
              
              if (signal.aborted) {
                  console.log("Process was successfully cancelled by the user.");
                  return;
              }
              
              if (proxiesToGenerate.length === 0) {
                  displayMessage("message_no_active_found");
                  hideLoading();
                  return;
              }
          } else {
              proxiesToGenerate = shuffledProxies.slice(0, requestedLimit);
          }
          
          const generatedUrls = [];
          const commonPort = security === "tls" ? 443 : 80;
          const generatedUUID = defaultUUID;
          const generatedPassword = defaultUUID;

          proxiesToGenerate.forEach(proxy => {
              const proxyIp = proxy.ip;
              const proxyPort = proxy.port;
              const proxyCountry = proxy.country;
              const proxyProvider = proxy.provider;

              const name = `${proxyCountry} - ${proxyProvider} (${proxyIp}:${proxyPort}) - ${vpnType.toUpperCase()}`;
              const path = `/${proxyIp}-${proxyPort}`;

              let server = selectedDomain;
              let host = selectedDomain;
              let sni = selectedDomain;

              if (customBug) {
                  server = customBug;
                  if (useWildcard) {
                      host = `${customBug}.${selectedDomain}`;
                      sni = `${customBug}.${selectedDomain}`;
                  } else {
                      host = customBug;
                      sni = customBug;
                  }
              } else {
                  host = selectedDomain;
                  sni = selectedDomain;
              }

              let connectionUrl = "";

              if (vpnType === "vmess") {
                  const vmessConfig = {
                      v: "2",
                      ps: name,
                      add: server,
                      port: commonPort,
                      id: generatedUUID,
                      aid: "0",
                      net: "ws",
                      type: "none",
                      host: host,
                      path: path,
                      tls: security === "tls" ? "tls" : "",
                      sni: sni,
                      scy: "auto",
                  };
                  connectionUrl = "vmess://" + btoa(JSON.stringify(vmessConfig));
              } else if (vpnType === "vless") {
                  connectionUrl = `vless://${generatedUUID}@${server}:${commonPort}?encryption=none&security=${security}&type=ws&host=${host}&path=${encodeURIComponent(path)}&sni=${sni}#${encodeURIComponent(name)}`;
              } else if (vpnType === "trojan") {
                  connectionUrl = `trojan://${generatedPassword}@${server}:${commonPort}?security=${security}&type=ws&host=${host}&path=${encodeURIComponent(path)}&sni=${sni}#${encodeURIComponent(name)}`;
              } else if (vpnType === "ss") {
                  const method = "chacha20-ietf-poly1305";
                  const userInfo = btoa(`${method}:${generatedPassword}`);
                  connectionUrl = `ss://${userInfo}@${server}:${commonPort}?plugin=v2ray-plugin%3Btls%3Bmode=websocket%3Bpath=${encodeURIComponent(path)}%3Bsni=${sni}#${encodeURIComponent(name)}`;
              }
              generatedUrls.push(connectionUrl);
          });

          generatedUrlsOutput.value = generatedUrls.join('\n');
          hideLoading();
          showConfigUrlModal();
        });

        copyAllUrlsBtn.addEventListener('click', function() {
            generatedUrlsOutput.select();
            generatedUrlsOutput.setSelectionRange(0, 99999);

            try {
                document.execCommand('copy');
                const originalText = this.textContent;
                this.textContent = translations[currentLanguage].message_copy_success;
                setTimeout(() => {
                    this.textContent = originalText;
                }, 1500);
            } catch (err) {
                console.error('Failed to copy:', err);
                displayMessage("message_copy_failed");
            }
        });

        statusSearchInput.addEventListener("input", () => {
            currentStatusPage = 1;
            renderStatusProxyList();
        });

        refreshStatusBtn.addEventListener("click", async () => {
            showLoading("loading_updating", false, false);
            allProxies = await getProxyListFromUrl(`${baseUrl}ALL.txt`);
            currentStatusPage = 1;
            renderStatusProxyList();
            hideLoading();
        });
      });
    </script>
  </body>
</html>
